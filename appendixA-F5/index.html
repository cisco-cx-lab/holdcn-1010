
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.1, mkdocs-material-7.0.6">
    
    
      
        <title>appendixA F5 - Cisco Live 2021 HOLDCN-1010</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2c0c5eaf.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.7fa14f5b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#appendix-a-l4-l7-insertion" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cisco Live 2021 HOLDCN-1010" class="md-header__button md-logo" aria-label="Cisco Live 2021 HOLDCN-1010" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cisco Live 2021 HOLDCN-1010
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              appendixA F5
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cisco Live 2021 HOLDCN-1010" class="md-nav__button md-logo" aria-label="Cisco Live 2021 HOLDCN-1010" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Cisco Live 2021 HOLDCN-1010
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task1-ansible-node/" class="md-nav__link">
        Task 1 - Prepare Ansible node
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task2-first-ansible/" class="md-nav__link">
        Task 2 - First Simple Ansible Playbook
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task3-vxlan-jinja2/" class="md-nav__link">
        Task 3 - Use of Jinja2 templates with Ansible Playbook
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task4-vxlan-nxos/" class="md-nav__link">
        Task 4 - Config switches using Ansible NXOS modules
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task5-day2-operation/" class="md-nav__link">
        Task 5 - Day 2 Operations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../appendixB-Upgrade/" class="md-nav__link">
        Appendix A - Upgrade
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="appendix-a-l4-l7-insertion">Appendix A: L4-L7 insertion</h1>
<p>In this section, you will insert F5 BIG-IP load balancer into the fabric. 
- First send out a http request from server-4 to a VIP, and you will notice no http service enabled on VIP. 
- Run the playbook to enable http service on the VIP with server-1, server-2, server-3 and server-4 in the server pool.
- After successful execute the playbook, you will notice http request to VIP is load balanced across three servers. </p>
<hr />
<h3 id="step-1-power-on-f5-virtual-machine">Step 1: Power on F5 Virtual Machine</h3>
<ul>
<li>
<p>open <strong>VMware vSphere Client</strong> to login ESXi <strong>(198.18.133.33)</strong> using crendentials of <strong>root/C1sco12345</strong></p>
<p><img alt="" src="../pic/a-1-1.png" /></p>
</li>
<li>
<p>Open up the VM under host <strong>198.18.133.33</strong>, and power on VM named <strong>F5_LTM</strong> as shown below:</p>
<p><img alt="" src="../pic/a-1-2.png" /></p>
</li>
</ul>
<hr />
<h3 id="step-2-install-ansible-pre-reqs">Step 2: Install Ansible pre-reqs</h3>
<ul>
<li>Switch to <strong>MTPuTTY</strong> install prerequisites packages on <strong>Ansible node</strong> by using below <code>pip install ...</code> commands (<strong>Note</strong>: the bold commands need to be executed):<pre><code>[root@rhel7-tools LTRDCN-1572]# pip install f5-sdk
[root@rhel7-tools LTRDCN-1572]# pip install setuptools --upgrade
[root@rhel7-tools LTRDCN-1572]# pip install bigsuds
[root@rhel7-tools LTRDCN-1572]# pip install netaddr
</code></pre>
</li>
</ul>
<hr />
<h3 id="step-3-check-virtual-ip-using-curl">Step 3: Check Virtual IP using curl</h3>
<ul>
<li>Switch to <strong>‘MTPuTTY’</strong> and ssh into server-4.  Then send http request to Virtual IP (VIP) 172.21.140.100 from server-4 using <code>curl http://172.21.140.100</code> command  </li>
<li>Below output shows the execution of above command i.e., HTTP request to VIP should fail:<pre><code>[root@server-4 ~]# curl http://172.21.140.100
curl: (7) couldn't connect to host`
[root@server-4 ~]#
</code></pre>
</li>
</ul>
<hr />
<h3 id="step-4">Step 4:</h3>
<ul>
<li>Switch to <strong>Atom</strong>, create new file name <strong>‘f5ltm.yml’</strong> under project folder <strong>LTRDCN-1572</strong>.  </li>
<li>Enter below data in this new file (named <strong>‘f5ltm.yml’</strong>)  </li>
<li>Make sure to click <code>File</code> and <code>Save</code> to ftp this data to Ansible server:</li>
</ul>
<pre><code class="YAML">---
- name: Configurating BIG-IP
  hosts: localhost
  gather_facts: false
  vars:
    provider:
      password: admin
      server: 198.18.4.10
      user: admin
      validate_certs: False

  tasks:
  - name: Configure server facing port to L2
    nxos_interface:
      interface: eth1/4
      mode: layer2
      username: &quot;{{ user }}&quot;
      password: &quot;{{ pwd }}&quot;
      transport: nxapi
      host: &quot;198.18.4.104&quot;
  - name: Configure VLAN for F5 port
    nxos_switchport:
      interface: eth1/4
      mode: access
      access_vlan: 140
      username: &quot;{{ user }}&quot;
      password: &quot;{{ pwd }}&quot;
      transport: nxapi
      host: &quot;198.18.4.104&quot;
  - name: Configure VLANs on the BIG-IP
    bigip_vlan:
      name: &quot;External&quot;
      tag: &quot;140&quot;
      untagged_interface: &quot;1.1&quot;
      provider: &quot;{{ provider }}&quot;
  - name: Configure SELF-IPs on the BIG-IP
    bigip_selfip:
     name: &quot;172.21.140.50&quot;
     address: &quot;172.21.140.50&quot;
     netmask: &quot;255.255.255.0&quot;
     vlan: &quot;External&quot;
     allow_service: &quot;default&quot;
     provider: &quot;{{ provider }}&quot;
  - name: Create static route
    bigip_static_route:
     provider: &quot;{{ provider }}&quot;
     destination: 0.0.0.0
     netmask: 0.0.0.0
     gateway_address: 172.21.140.1
     name: &quot;defult&quot;
  - name: Create nodes
    bigip_node:
      provider: &quot;{{ provider }}&quot;
      host: &quot;{{item}}&quot;
      name: &quot;{{item}}&quot;
    with_items:
      - 172.21.140.10
      - 172.21.140.11
      - 172.21.141.10
      - 172.21.141.11

  - name: Create pool
    bigip_pool:
      provider: &quot;{{ provider }}&quot;
      name: &quot;web-pool&quot;
      lb_method: &quot;round-robin&quot;
      monitors: &quot;/Common/http&quot;
      monitor_type: &quot;and_list&quot;

  - name: Add Pool members
    bigip_pool_member:
      provider: &quot;{{ provider }}&quot;
      name: &quot;{{item}}&quot;
      host: &quot;{{item}}&quot;
      port: &quot;80&quot;
      pool: &quot;web-pool&quot;
    with_items:
      - 172.21.140.10
      - 172.21.140.11
      - 172.21.141.10
      - 172.21.141.11

  - name: Add Virtual Server
    bigip_virtual_server:
      provider: &quot;{{ provider }}&quot;
      name: &quot;http-virtualserver&quot;
      destination: &quot;172.21.140.100&quot;
      port: &quot;80&quot;
      enabled_vlans: &quot;ALL&quot;
      all_profiles:
      - http
      pool: &quot;web-pool&quot;
      snat: &quot;Automap&quot;

</code></pre>

<hr />
<h3 id="step-5-run-playbook">Step 5: Run playbook</h3>
<ul>
<li>
<p>On the <strong>Ansible node</strong> (using MTputty SSH), run playbook <strong>f5ltm.yml</strong> to provision VIP (172.21.140.100) on F5 and to also put all four servers into the server pool using <code>ansible-playbook f5ltm.yml</code> command.  </p>
</li>
<li>
<p>Below shows the output of above command: </p>
</li>
</ul>
<p><img alt="" src="../pic/a-5-1.png" /> </p>
<hr />
<h3 id="step-6-check-load-balancer">Step 6: Check load balancer</h3>
<ul>
<li>Switch to <strong>‘MTPuTTY’</strong> and login to <strong>server-4</strong>,</li>
<li><strong>Run</strong> <code>curl http://172.21.140.100</code> command multiple times, <ul>
<li>Note that the request is load balanced to differert servers in the sever pool</li>
</ul>
</li>
<li>The execution and output of above command (when its run multiple times) is shown below: </li>
</ul>
<pre><code>[root@server-4 ~]# curl http://172.21.140.100
&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;
&lt;p&gt; Server-1 172.21.140.10 &lt;/p&gt;
&lt;p&gt;This is the default web page for this server.&lt;/p&gt;
&lt;p&gt;The web server software is running but no content has been added, yet.&lt;/p&gt;
&lt;/body&gt;&lt;/html&gt;

[root@server-4 ~]# curl http://172.21.140.100
&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;
&lt;p&gt; Server-3 172.21.140.11 &lt;/p&gt;
&lt;p&gt;This is the default web page for this server.&lt;/p&gt;
&lt;p&gt;The web server software is running but no content has been added, yet.&lt;/p&gt;
&lt;/body&gt;&lt;/html&gt;

[root@server-4 ~]# curl http://172.21.140.100
&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;
&lt;p&gt; Server-4 172.21.141.11 &lt;/p&gt;
&lt;p&gt;This is the default web page for this server.&lt;/p&gt;
&lt;p&gt;The web server software is running but no content has been added, yet.&lt;/p&gt;
&lt;/body&gt;&lt;/html&gt;
</code></pre>

<p><strong>This concludes Appendix A using ansible to insert F5 (as load balancer) in the DC Fabric.  Well done!</strong></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.a1c7c35e.min.js"></script>
      
    
  </body>
</html>